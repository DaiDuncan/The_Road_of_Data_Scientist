[link: kaggle竞赛宝典|比赛框架](https://mp.weixin.qq.com/s?__biz=Mzk0NDE5Nzg1Ng==&mid=2247489915&idx=1&sn=abd30290179ce03e2402ce454ac4e558&chksm=c32900f4f45e89e208f162807cd7250dfc58ab5dad1aef594d7f6761b0fe7254b28f923b3577&scene=21#wechat_redirect)

- 1 关于数据竞赛

- - 1.1  为什么你应该参加数据竞赛？
  - 1.2 数据竞赛能带来什么

- 2 竞赛流程

- - 2.1 概述

  - 2.2 数据竞赛建模流程

  - - 2.2.1 问题理解，分析，规划
    - 2.2.2 数据探索分析
    - 2.2.3 样本筛选、样本组织
    - 2.2.4 验证策略设计
    - 2.2.5 模型理解和选择
    - 2.2.6 特征工程
    - 2.2.7 模型训练、验证、测试
    - 2.2.8 模型预测结果分析
    - 2.2.9 后处理
    - 2.2.10 模型融合
    - 2.2.11 复盘总结

  - 2.3 本章小结

# 关于数据竞赛

最近和Datawhale一起去高校做了关于AI开源相关的分享，在浙大以及杭电的分享交流中，我们发现对于大数据竞赛了解的朋友占比不到5%，参加分享的200+的小伙伴，对于数据竞赛了解的**不足10个**，这其实很令我惊讶。



## 1 为什么你应该参加数据竞赛？

不管是计算机专业的，人工智能专业的还是农学院，化学专业，或者天文学专业的朋友，我都非常鼓励这些朋友去参加一些和自己专业相关的数据算法竞赛，为什么呢？很多时候可能很难解释，可能只有自己试了才知道为什么，举个简单的例子，在之前的各类赛题中，

- 有一些赛题是天文数据相关的，例如天池的天文大数据竞赛，还有kaggle的天文赛题，这些题自然而然的吸引了诸多天文学科背景的本硕博以及已经毕业的朋友的加入，但最终很多时候大家发现最终夺冠的可能并不是这些本专业的同学，而是**学习大数据竞赛的朋友**；
- 有一些赛题是化学相关的，同样地，我们发现最终获奖的，可能也是学习大数据竞赛的朋友；
- ...

为什么呢？没有相关专业背景的朋友最终取得了不错的成绩。

甚至冠亚季军都被计算机或者做数据竞赛相关专业的朋友包揽了。

最后这些参加数据竞赛的朋友很多也都爱上了大数据科学，并利用相关的技术在自己的专业发光发热，所以说，数据竞赛，值得所有专业的朋友一试。



## 2 数据竞赛能带来什么

这个实在是太多了，不管是**荣誉，奖金，知识，成长进步，以及求职带来的帮助**等等。

但其实在我认识的所有朋友中，不管最终有没有取得过竞赛奖项，几乎所有参加过数据竞赛的朋友都觉得：

- 参加数据竞赛，很棒，从未后悔。

这里面的过程很难说，有开心，有痛苦，但真的很上瘾。

不管是排行榜单的起起伏伏，还是在**竞赛过程中所有学到的trick**，亦或是qq群微信群中各种虚虚假假的信息，每一个部分都会让人非常怀念，热爱。

不管最后是夺奖，亦或是差一名的遗憾，总之享受过程，不留遗憾。



# 竞赛流程

到目前为止，国内外数据竞赛已经走过了五+个年头，因为是新的领域，所以很多东西都没有太多沉淀，虽然有一些竞赛相关的书籍，或者大量的博客，但其实很多东西不完整，亦或者是有些错误。

本文，我和朋友们将在过往的竞赛中的竞赛经验流程汇总成一套相对完整的框架，目前几乎所有的竞赛（排去最新的强化学习相关的竞赛），其他的表格，图像，文本等都可以整理到此框架中。



## 1 概述

当我们进入某个数据竞赛，会拿到关于该数据竞赛的背景描述、问题定义、重要时间段信息以及对应的数据字段信息等。

然后针对该问题，我们需要对其进行分析建模。此处，我们将分析建模流程细分为十一个小模块：

1. 问题理解，分析，规划；
2. 数据探索分析；
3. 样本筛选、样本组织；
4. 验证策略设计；
5. 模型理解和选择；
6. 特征工程；
7. 模型训练、验证、测试；
8. 模型预测结果分析；
9. 后处理；
10. 模型融合；
11. 复盘总结；

每个小模块都会有很多对应的细节需要思考和注意，模块与模块之间也存在密切的联系，为了方便理解，我们在本章节按照分析建模的标准流程对每个模块以及先后关联进行简单的阐述，每个模块的细节大家可以在后面的章节中进行细致的学习。



## 2 数据竞赛建模流程

我们点开一些平台的数据竞赛页面之后，会看到下面的信息，此处我们以天池的一些竞赛为例，

我们选择自己感兴趣的赛题点击进入，一般会看到下面的界面，

![图片](https://mmbiz.qpic.cn/mmbiz_jpg/k20ecIowF5b5kQBfrhaytprmRdEHEgt4bibSQEfrTEt2TibAZwyfOOk4cPzN1h9SUUEib8dHGBl9ibQBG3bHrRoTbQ/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

几乎所有的比赛都是类似的，点击进入之后一般就是有关于该竞赛的赛制描述，问题的定义、数据信息、评估指标、比赛时间、论坛等信息。

在阅读完这些信息之后，便正式开启数据竞赛的征程。我们该如何动手呢？

### 1. 问题理解，分析，规划

![图片](https://mmbiz.qpic.cn/mmbiz_jpg/k20ecIowF5b5kQBfrhaytprmRdEHEgt4SaACZLkMFpOHEsYjiccAwlG8If5VC2iaUibIxXdcJ4EFtnZlseFF1geTg/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

首先，在第一步我们需要做的就是对赛题的背景进行理解、分析并做细致的竞赛规划。

具体地，我们需要思考数据的**收集模式**，

- 是否会因为数据收集方式的方式手段而引入较多的脏数据？
- 数据的标签来源是什么，是否打标的方式和我们的直观不符？
- 评估指标是否可以直接优化，对于不可以直接优化的目标是否可以采用某些技巧来进行优化？
- 除此之外，我们还需要基于赛事的重要时间点进行详细地规划，
  - 包括什么时候考虑做模型融合、
  - 组队的时间范围等。
- 此外，我们还需要对每日的评估次数做衡量，
- 最后便是花一些时间去收集**该赛事相关的所有资料**方便后续参考与学习。



### 2. 数据探索分析

![图片](https://mmbiz.qpic.cn/mmbiz_jpg/k20ecIowF5b5kQBfrhaytprmRdEHEgt4nusiajJW41ibFMSbsQssVgJq5HboKsn4uUc9rJA4nUrPX3A828hnFVAQ/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

对赛题有了大致的了解，初步的竞赛计划也制定好之后，下面便进入第二步，对官方所给的数据进行细致的分析与探索，对于数据的探索与分析是为了能更好地理解数据，

- 包括数据的整体情况、
- 每个字段的含义、
- 数据字段中是否存在奇怪的或错误的情况（例如某些特征字段中出现了大量的空值，身高体重等特征中出现了负数的情况等）、
- 标签是否分布平衡、
- 特征字段与标签的关系、
- ==训练集合与测试集合的**数据分布是否存在较大的差异**等。==

初期的特征探索与分析能帮助我们更好地理解数据，为后面的决策提供强有力的参考。



### 3. 样本筛选、样本组织⭐

![图片](https://mmbiz.qpic.cn/mmbiz_jpg/k20ecIowF5b5kQBfrhaytprmRdEHEgt4kE58cla3fT0iakVQ9x3XDy0aR79IErtHcgafxQUCKy4x52Xflrlt2Hg/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

做完初步的数据探索以及分析之后，再往下一步我们需要基于在数据探索分析部分得到的结论进行样本的筛选、组织。

在建模的过程中，**异常的数据**往往会给模型带来较大的误导，所以建模早期对于样本的筛选至关重要。

在一些流量预测问题中，例如地铁人流量预测问题中，如果我们使用节假日期间地铁的流量数据建模预测非节假日的地铁流量，就会有非常大的概率误导模型的训练，从而使模型无法获得好的效果。

在70%以上的问题中，平台已经帮助我们组织好了样本，例如反欺诈的任务等，我们不需要耗费太多的经历去对样本进行重新组织。

但在一些特定的问题中，**训练集和测试集的构建是需要我们自己设计的**，此时我们==需要对样本进行精心的组织从而得到我们的训练集、验证集以及测试集==，此类情况常见于存在**时间关系的数据建模问题中**，

- 例如预测未来一周内某类商品每一天的销量；
- 判断某个平台上每个用户未来一周内最有可能购买的商品等。

这个时候我们往往需要对标签集合和特征集合进行细致的设计，尽可能多的使用到更多有价值的信息来提升我们模型的效果，对于样本的组织使用在此时就会显得尤为重要。



### 4. 验证策略设计

![图片](https://mmbiz.qpic.cn/mmbiz_jpg/k20ecIowF5b5kQBfrhaytprmRdEHEgt4yeJmd9oiccTicCBS3f5IDrEkdoArXb8icNnpU2ICv4kQyygrZXp9e5wVw/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

做完样本的初步筛选，并对样本进行重新组织之后。

下一步要做的就是基于上面的分析进行线下验证策略的设计。

验证集设计的合理与否，对整个竞赛都有着重大的影响，如果模型的线下结果和线上结果不一致，就会导致无法继续进行后续的实验。

==所以是直接采用简单的五折交叉验证做线下验证，还是进行分组进行交叉验证亦或是按照时间顺序进行训练集和验证集合的划分？==

是我们在这一块需要重点思考的问题。



### 5. 模型理解和选择

![图片](https://mmbiz.qpic.cn/mmbiz_jpg/k20ecIowF5b5kQBfrhaytprmRdEHEgt49mI6LrP2elq2myQH9eP4T07OCEAjAxH6rjaibOxiamkQObjictLKdOCBA/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

当验证策略设计完成之后，下一步就是**进行模型的选择并构建相对应的特征**，在实践中，存在成千上万的模型，每种模型对于数据的吸收方式和效果也都存在较大差异，

- 比如神经网络模型往往需要对数值类的特征进行归一化操作，如果数值特征中存在奇异值，在很多时候会对模型带来灾难性的影响，导致模型无法拿到理想的结果；
- 而梯度提升树相关的模型，例如XGBoost，LightGBM，CatBoost等在建模的时候则往往**不需要对特征进行归一化**，对于特征中出现的**极大极小值**也有较好的鲁棒性。

究竟选用何种模型是困扰所有参赛选手的问题之一。

幸运的是，在过往的四五年的数据挖掘竞赛中，大家尝试了大量的机器学习算法，发现在基于表格形的数据建模中，基于梯度提升树的建模往往可以取得更好的成绩，而我们对这些历史竞赛进行了统计，也发现对于表格形的数据算法竞赛，**超过90%以上的获奖方案目前都还是基于梯度提升树模型的**。

所以本书中，我们主要针对梯度提升树展开，介绍梯度提升树的数学原理，对于数据吸收的方式，以及这种方式的优缺点等。



### 6. 特征工程

在模型基本选定之后，接下来的要做的就是细致的特征工程，模型与特征是相辅相成的，此处我们将模型与特征工程当做一个整体进行处理。

对于设计的模型我们希望它可以充分吸收数据并从数据集中自动挖掘出与我们标签相关的信息，从而能更好地对我们的测试数据进行预测，但从目前模型的发展情况来看，暂时还没有哪种模型可以自动化地对数据进行充分的挖掘，因而我们需要通过人为的方式对数据进行处理，包括特征预处理、组合特征的构建、特征的筛选等等，在模型数据处理的弱势区域对其进行帮助，从而使得我们模型可以获得更好的效果。

换言之，==特征工程就是在帮助模型学习，在模型学习不好的地方或者难以学习的地方，采用特征工程的方式帮助其学习==，通过人为筛选、人为构建组合特征让模型原本很难学好的东西可以更加轻易的学习从而拿到更好的效果。

在后续的内容中，我们会针对目前在大数据竞赛圈和工业界表格数据问题上最为流行的梯度提升树模型进行探讨，先介绍针对梯度提升树可以采用的通用特征工程方案以及在特定领域的许多业务特征。



### 7. 模型训练、验证、测试

![图片](https://mmbiz.qpic.cn/mmbiz_jpg/k20ecIowF5b5kQBfrhaytprmRdEHEgt4DlgsKnlyDYac3NGlLmcXcySD2rHHzEDYEJiacrkQjY2BjmzsIPcZ4aQ/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

在第一版特征工程完工之后，我们将抽取得到的特征与对应的标签信息输入到我们的模型中进行模型的训练、验证，在模型的训练过程中，我们会比较如何得到好的模型参数，这对于最终模型的预测效果的影响还是非常大的，所以这一块我们需要了解并掌握一些**常用的调参技巧**，

- 例如暴力式的调参，贪心的贝叶斯调参等。

- 与此同时我们还需要了解在某些特定问题中，**一些核心参数的重要意义**以及在碰到此类问题的时，我们该如何调整这些参数等。



### 8. 模型预测结果分析

![图片](https://mmbiz.qpic.cn/mmbiz_jpg/k20ecIowF5b5kQBfrhaytprmRdEHEgt4QjtwfTsmoMib06a0wS3OdhzMrsFicgwd3BeAulvKUQyyibqvOt9Kvuiaww/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

通过贝叶斯亦或者是其他方式得到我们相对满意的参数之后，我们使用该参数对模型进行训练并对测试集的数据进行预测提交。

依据线下验证的结果、线上的结果对模型的预测进行分析，==如果线下和线上出现了较大的不一致，那么我们可能就需要思考为什么不一致==，

- 是不是模型的验证策略有误，
- 是不是特征出现了穿越，
- 亦或者在哪个步骤出现了问题。



而如果我们未发现任何问题，模型的线下和线上结果基本和自己所期望的一致，那么很幸运，我们可以继续往下走，这个时候我们进入到第二类的数据分析模块，预测结果的数据分析。

- 例如在多分类中，我们就需要观察究竟是哪几个类进行会相互分错，这样观测能不能基于这些分错的类进行某些处理来达到更好的预测效果；

- 在回归问题中，我们可能就需要观察我们预测最大的误差在哪里？这些预测最大的误差能否通过某种方式来缓解等等。

在很多数据竞赛问题中，如果上面的流程走通了，没有太多的问题，我们便可以进行数据探索分析，特征工程，模型训练验证测试，模型结果分析等闭环中，不断加强每个模块，最终直到我们的单模效果到达我们较为满意的结果时，我们再考虑对模型结果进行集成从而拿到最终的结果。

但在有些特殊的数据竞赛问题中，上面这个流程还需要加入另外一个模块，此处我们称之为后处理。



### 9. 后处理

![图片](https://mmbiz.qpic.cn/mmbiz_jpg/k20ecIowF5b5kQBfrhaytprmRdEHEgt4YUszXKrxmibicPJKK6GhAgF2M0oSWh7IB0pSQ4Xz6YYb6YGLXxyITT2w/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

存在一些特殊的问题，它们的**评估指标是难以直接优化的**，这个时候我们就需要考虑**对最终的预测结果进行后处理等操作来提升我们的指标预测效果**，最典型的就是F1等指标的优化，我们往往需要对模型的预测结果进行某些加权或者分组加权的操作来修正我们模型的预测结果，从而拿到更好的预测结果。

还有一些后处理是基于问题背景设计的，

- 例如：有时候我们需要预估某人的记录是否有欺诈行为，一旦有欺诈行为，该人的所有记录都会被标记为1。
- 但是，很多时候我们模型就会对于该人的每个行为的预测结果都会有些许区别，导致有些记录预测为欺诈的概率较大，有些又预测为非欺诈的概率较大，
  - 这个时候我们就需要对我们的预测结果进行后处理，从而拿到更好的效果。

在后处理之后，一般我们会对后处理得到的结果进行重新的预测结果分析，在问题不大的情况下，就可以和前面一样，进入数据探索分析，特征工程，模型训练验证测试的闭环中直到拿到我们满意的单模结果。

### 10. 模型融合

![图片](https://mmbiz.qpic.cn/mmbiz_jpg/k20ecIowF5b5kQBfrhaytprmRdEHEgt4fgfficfWKw1xaZLtCmAdvDqgDxoduDwr7aDjMRP8T2xg7qTwBqw3icGA/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

在单个模型的效果达到相对满意的程度时，亦或是比赛快要接近尾声时，**我们希望可以进一步提升模型的效果**，这个时候我们就需要进行模型的融合，不同问题的融合方式会有些许不一样，

- 比如auc问题我们一般可以采用对预测结果先进行rank，然后对rank进行加权融合等，
- 而回归类的模型则可以采用MSE的优化和MAE的优化得到的结果进行融合等。

关于详细的融合相关的内容，我们会在后续的章节中进行更为细致详细的介绍。



### 11. 复盘总结

最后，竞赛结束之后，不管最终取得了什么样的成绩，==一般我们都会静下心来总结，复盘学习。==

看看其它优秀的队伍是如何思考处理该问题的，有哪些可以直接学习和借鉴的地方，争取做到在下次同样的地方不犯相同的错误，也为今后的数据竞赛或者实践项目做准备。



# 本章小结

在本章节中，我们把建模的整体流程以及每个模块大致需要做哪些事情，思考哪些问题的内容进行了粗略的介绍，整体而言，上述每个模块可以汇总到下面的这张大图中：

![图片](https://mmbiz.qpic.cn/mmbiz_jpg/k20ecIowF5b5kQBfrhaytprmRdEHEgt4XosLEbAwuOshuzRhyFajHic7RuVrjMQYIv7cBSycQMULdaEicH8x5k3g/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

在数据竞赛亦或是数据实践项目中，模块与模块之间都是环环相扣的，每一个模块的错误都可能为整体效果带来较大的影响，所以我们在处理问题时往往需要不断地思考各个环节的细节等，形成下面的闭环。

![图片](https://mmbiz.qpic.cn/mmbiz_png/k20ecIowF5b5kQBfrhaytprmRdEHEgt4nDZVXSg2KKVDcXKdMw3ZGBo4LOvco3XiaxGJb9InGZR46o5dsibbA3dQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

在后续每周的更新中，我们会将每个小模块具体需要做哪些事情，有哪些trick进行细致的汇总。欢迎大家关注我们的公众号《kaggle竞赛宝典》，