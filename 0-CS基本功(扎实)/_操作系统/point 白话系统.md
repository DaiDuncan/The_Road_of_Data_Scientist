作者：AI蜗牛车
链接：https://zhuanlan.zhihu.com/p/296952897

## **一、引言**

相信线程，进程，协程， 并发，并行，同步，异步，阻塞和非阻塞这几个概念大家在编程过程中肯定会遇到，但是这几个概念又那么类似很容易让人模糊



## **二、并发与并行**

## **2.1 并发|两个锅/进程**

咱们用做早饭来举例，例如说你还没起床，你的女朋友已经早早的起来了，在厨房给你准备早饭，她想给你做一份面包片和煎蛋，她为了能让你尽快的吃上早饭，开了**两个锅**，

- 一个锅用来煎蛋，
- 一个锅用来煎面包片，

但是她为了食物尽可能美味，只能看一下煎蛋的锅，再去看一下烤面包片，这样每个锅看一分钟，来回切换，这样终于把面包片和煎蛋做好了，这时你也睡醒了，吃到了美味的早餐。

你女朋友的这个做早饭的流程就是并发操作，因为她不可能同时将注意力放在两个锅上，只能通过逐渐切换注意力的方式来使任务很好的完成。

但是如果你的女朋友可以在两个锅之间切换的足够快，**在旁边看起来**就像是她在同时操作两个锅 。



## **2.2 并行|两个人/CPU**

咱们还是用做早餐为例，现在你和你的女朋友在一起已经很久了，她再也受不了天天早上给你做饭的日子了，所以今天早上她把你也拽起来和她一起做饭。

同样还是煎面包片和煎蛋，这时你和你女朋友一人一个锅，

- 你在准备煎蛋，
- 你的女朋友在煎面包片，

你俩就这样很和谐的做着自己的事互不干扰，很快就吃到了美味的早餐。你和你的女朋友同时做饭，每个人操作一个锅的方式就是并行操作 。



## **2.3 图解并发并行**

我们有两个任务A和B，分别采用并发和并行的方式执行。 



下图并发：可以看到虽然A和B作为两个整体的任务但是未必会直接执行完，而是会在两个任务间来回切换。

因为cpu切换的速度实在太快了，所以我们看起来好像是A和B在同时执行，但其实在每个时间点上只有一个任务在执行。

![img](https://raw.githubusercontent.com/DaiDuncan/PicUploader/main/img2/20210422091822.jpeg)





并行的方式就是将两个任务同时执行，如下图所示。 

![img](https://raw.githubusercontent.com/DaiDuncan/PicUploader/main/img2/20210422091840.jpeg)



## **三、进程，线程与协程**

## **3.1 进程|盖房子**

电脑中**每个软件的启动就代表一个进程**，简单来说就是把写的程序加载到操作系统中来执行预定好的任务。

操作系统会**为进程分配相应的资源**来支撑它完成任务，每个进程会分配一个**唯一的标识PID**。 

![img](https://raw.githubusercontent.com/DaiDuncan/PicUploader/main/img2/20210422091859.jpeg)

 我们用老王来举例，假如说老王现在想盖个房子，我们就可以把盖房子这件事作为一个任务，当盖房子这件事启动的时候也就意味者启动了一个进程。



## **3.2 线程|请工人**

线程是==进程的执行实例==，是一个程序执行的最小单元，**每个进程里的任务会有线程去具体执行**。 

![img](https://raw.githubusercontent.com/DaiDuncan/PicUploader/main/img2/20210422091914.jpeg)

我们还是继续说老王，现在盖房子这个任务已经确定下来了，但是他发现自己不会盖，要请个工人来盖房子，于是他去外面请了一个工人A，这个工人A要做搬砖和搬木头的工作，此时这个工人A就是一个线程，老王还要求他这两个任务不能差距太大，要同步进行，所以这个**工人A只能搬一趟转头，搬一趟木头**，这样的操作就是**单线程的并发操作**。



干了两天，工人A不高兴了干的活太多了要加钱，这时老王一看一个人干也确实慢，就去外面又请了一个工人B，此时工人B也就对应着一个线程，老王让工人A继续搬砖，而工人B来负责搬木头，这样两个任务就能同时进行了，这就是**多线程的并行操作**。而且此时工人A和工人B是**同时共享着老王提供的资源**。



## **3.3 进程与线程+单核与多核**

其实刚才老王那个例子已经能解释进程与线程的操作了，但是有些细节描述的不够清楚。

- 如果我们使用的是**单核CPU，那么我们是无法执行并行操作的，只能做到并发**，这样来充分调用CPU的资源。
- 如果我们使用的是==多核CPU，我们才可以真正的意义上做到并行操作==。

我们的操作系统在**进程或线程间切换**是比较消耗资源的，因为要保存当前运行状态的上下文信息，而且进程或线程的切换是由操作系统决定的，**到达运行时间之后，操作系统会将当前执行的任务挂起**，我们只能等待下个分配到的时间片来继续执行任务。

这也就引出来协程的概念。



## **3.4 协程**⭐

就像我们刚才说到的，任务的切换是操作系统来控制，我们**有没有什么办法来减小这种开销呢？**

我们就可以使用协程，协程我们可以理解为**轻量级的线程**。



协程在执行过程中不会由操作系统直接操作，而是**由调度器决定**，比如调度器发现协程A是一个**长耗时**操作，那么调度器就可以将其挂起去执行其他协程，等到协程A耗时任务结束后会==加入待执行队列==等待调度器调度。



## **四、同步与异步**

- 同步：当我们同步的执行某个任务时，我们需要等到这个任务执行完给我们反馈结果，我们才能去执行其他的任务。
- 异步：但是异步的执行某个任务时，我们可以**不用等这个任务结束就去执行另一项任务**。
  - 通过异步执行的任务执行结束后我们可以通过==回调函数获得结果==。



我们可以明显的看出同步和异步的差别，那异步操作看起来效率那么高为什么不都使用异步操作呢？

同步操作存在的意义是**有些任务必须是按顺序执行的**，就像我们去银行取钱，最起码的保证你的银行账户里有钱你才能取吧 ，这也是为什么数据库中存在**事务**这一概念。



在一个系统中每一次请求，时间越长存在超时的风险就越大，逻辑越复杂执行的步骤越多，存在失败的风险也就越大。

如果在业务允许的情况下，用户调用某个请求后只给用户必须要的结果，将一些操作作为异步进行操作，这就减少了超时的风险也把复杂业务进行拆分减低复杂度。



常见的异步化操作有一下几种：

- 服务端接收到请求后，**创建新的线程**处理业务逻辑，然后先将**指定应答**返回给客户端。
- 服务端接收到请求后，服务端**先给客户端返回指定应答**，再**继续处理业务逻辑**。
- 服务端接收到请求后，服务端**把信息保存在消息队列或者数据库中**，然后回应答给客户端，
  - 服务端**业务处理进程**，再从消息队列或者数据库上读取信息处理业务逻辑。





## **五、阻塞与非阻塞**

阻塞和非阻塞乍一听起感觉很好理解，但其实有许多细节值得去推敲

- 阻塞调用是指调用结果在返回之前，**当前线程会被挂起**。
  - 调用线程只有在得到结果之后才会返回。
- 非阻塞调用指在**不能立刻得到结果之前**，该调用不会阻塞当前线程。



阻塞，非阻塞，同步，异步常与==IO操作==联系起来，你一定听过NIO(Non-blocking I/O)，它是一种同步非阻塞的I/O模型，也是**I/O多路复用**的基础，已经被应用到许多**大型应用服务器，成为解决高并发与大量连接、I/O处理问题的有效方式**。

关于阻塞，非阻塞，同步，异步与IO操作之间的区别与联系我们在下一篇文章再好好分析一下。



## **六、总结**

这里用了一些简单的说明与例子来解释我们编程中常会遇到的几个概念，但其中还有许多细节值得去深入研究，例如操作系统中的进程切换，进程调度算法与进程切换时上下文的切换等等，接下来的系列文章中争取采用举例+画图+代码的形式尽量用深入浅出的方式帮助大家理解这些计算机的相关基础知识。







# #参考文献

[link: 原文|并发与并行，进程、线程与协程， 同步与异步，阻塞与非阻塞 2020.11.16](https://www.zhihu.com/column/c_1312178237071028224)