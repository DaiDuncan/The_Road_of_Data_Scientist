# 概念

- 文件：具有文件名的一组相关元素的集合

- 文件组成：数据项、记录、文件

- ==文件的属性：名称、标识符、文件类型、文件位置、文件大小、建立时间、用户标识==

- 文件的分类

  - 按用途分类：系统文件、库文件、用户文件

  - 按保护级别分类：只读文件、读写文件、执行文件、不保护文件

  - 按**信息流向**分类：输入文件、输出文件、输入/输出文件

  - 按**数据形式**分类：源文件、目标文件、可执行文件

- 文件的操作

  - 基本操作：创建、删除、读、写、截断、设置文件的读/写位置

  - 打开文件操作(关联信息:文件指针、文件打开计数、文件磁盘位置、访问权限)

  - 关闭文件操作

- 文件的逻辑结构

  - 与存储设备无关，又可分为有结构的记录式文件和无结构的流式文件

  - 记录式文件

    - 顺序文件(连续结构)

      - 分类1：定长记录顺序文件、变长记录顺序文件

      - 分类2：串结构、顺序结构

      - 优点：顺序存取时速度快，若为定长记录文件则可随机访问

      - 缺点：存储要求连续的空间，会产生碎片，不利于文件动态扩充

    - 索引文件

      - 为一个逻辑文件的信息建立一个索引表，表目存放文件记录的长度和所在逻辑文件的起始位置

      - 索引表本身是一个定长文件，每个逻辑块可以为变长，索引表+逻辑文件=索引文件

      - 优点：可以随机访问、易于文件增删

      - 缺点：空间开销大、查找策略不利于效率

    - 索引顺序文件

      - 将顺序文件中所有记录分为若干组，为顺序文件建立一张索引表，每组第一个记录在索引表建立一个索引项(含该记录的关键字和指向该记录的指针)

      - 索引表中索引项按照关键字顺序排列，索引顺序文件的逻辑文件是一个顺序文件，每个分组内部的关键字不必有序排列，但组与组之间的关键字有序排列

      - 优点：大大提高了顺序存取的速度

      - 缺点：需要配置索引表，增加了存储开销

    - 直接文件及散列文件

      - 建立关键字和相应物理地址之间的对应关系，直接通过关键字的值找到物理地址

      - 优点：存取速度高

      - 缺点：不同关键字拥有相同函数值而产生冲突



# 文件目录

- 文件目录：文件说明的集合

- 目录功能：实现按名存取、提高检索速度、允许文件同名、运行文件共享

- ps.通常文件目录也作为一个文件来处理，成为目录文件；文件目录放在外存中！

- 目录实现：线性表、散列表

- 文件控制块：保存文件属性信息的数据结构

  - 内含：文件名、文件的结构、文件的物理位置、存取控制信息、管理信息

- 索引节点：文件描述信息单独形成一个索引节点

  - 磁盘索引节点：文件主标识符、文件类型、文件存取权限、文件物理地址、文件长度、文件链接计数、文件存取时间

  - 内存索引节点：除上面内容外，另外还有索引节点编号、状态、访问计数、逻辑设备号、链接指针

- 目录结构

  - 单级目录结构

    - 只建立一张目录表，每个文件占据其中的一个表目

    - 优点：易于实现、管理简单

    - 缺点：不允许文件重名、文件查找速度慢

  - 二级目录结构

    - 将文件目录分为主文件目录和用户文件目录，系统为每个用户建立一个单独的用户文件目录；主文件目录记录各用户文件目录的情况，用户文件目录记录该用户建立的所有文件及其说明情况

    - 优点：可解决文件重名问题，并可获得较高的查找速度

    - 缺点：缺乏灵活性(特别是用户需要进行合作和访问其他文件时)

  - ==树形目录结构==

    - 为每个文件赋予唯一的标识符

    - 新概念：路径名、当前目录

    - 优点：文件分类便捷、文件管理和保护更有效、解决了文件重名问题

    - 缺点：需要按照路径名逐级访问，访问次数多即速度慢

  - ==图形目录结构==

    - 在树形基础上增加了指向同一结点的有向边，使整个目录成为一个有向无环图

    - 优点：方便共享

    - 缺点：管理复杂



# 文件共享与保护

- 共享

  - ==基于索引结点的共享方式(硬链接)==

    两个不同的目录项指向**相同的索引节点**

    - 优点：可以实现文件的异名共享

    - 缺点：当文件被多个用户共享时，文件拥有者不能删除文件

  - ==利用符号链实现文件共享(软链接)==

    创建一个叫**链接的新目录项**，如果要使用户B能够共享C的文件，则在用户B的目录下建一个含共享文件路径名的新目录项

    - 优点：能够用于链接世界上任何地方的计算机中的文件(提供文件所在机器的网络地址以及该机器中的文件路径)

    - 缺点：其他用户要访问共享文件时，需逐层查找，开销较大

- 保护

  - 访问类型控制：读、写、执行、添加、删除、列表清单、重命名、复制、编辑

  - 访问控制：访问控制矩阵、访问控制表、用户权限表、口令、密码





# 文件系统

- 文件系统的层次结构

  - 用户接口、文件目录系统、存取控制验证、逻辑文件系统与文件信息缓冲区、物理文件系统

- 外存分配方式

  - 连续分配(顺序文件结构)

    - 为文件分配连续的磁盘区域，用户需在分配前说明创建文件所需存储空间大小

    - 优点：查找速度比其他方法快，关于文件物理存储位置的信息简单

    - 缺点：易产生碎片，需定期进行空间紧缩；不适合文件随时间动态增减的情况

  - 链接分配

    - 优点：简单，文件创建与增长容易实现

    - 缺点：不能随机访问盘块，链接指针会占用空间，可靠性不好

    - 隐式链接：链接物理块的指针隐式地放在每个物理块中；目录项中有指向索引顺序文件的第一盘块和最后一块盘块的指针，每个盘块有指向下一盘块的指针

    - 显示链接：链接物理块的指针显式存放在内存的一张链接表中，每个磁盘设置一张链接表(又称为文件分配表)

  - ==索引分配==

    - 系统为每个文件分配一个索引块，索引块中存放索引表，索引表中的每个表项对应分配给该文件的一个物理块

    - 优点：支持直接访问、不会产生外部碎片、文件长度不受限制

    - 缺点：增加存储空间开销、存取文件需要2次访存，存取速度低

    - 单级索引分配、两级索引分配、混合索引分配（这里可能会有计算题）

- 文件(空闲)存储空间管理

  - 空闲文件表法——适合①只有少量空闲文件时②连续文件

  - **空闲块链表法**

  - 位示图法

  - 成组链接法——UNIX的文件存储空间管理方法/适用于大型文件系统

    - 分配空闲盘块的方法、空闲盘块回收的方法

    - 优点：占用空间小，超级块不大且可以放在内存中，效率高



# 磁盘管理

- ==磁盘：典型的直接存取设备，磁盘上的每个物理块可以用柱面号、磁头号、扇区号表示==

- ==磁盘结构：引导控制块、分区控制块、目录结构、文件控制块==

- 磁盘访问时间

  - 访问时间=寻道时间+旋转延迟+传输时间

  - 寻道时间=每移动一个磁道需要时间*移动磁道数+启动磁臂时间

  - 旋转延迟=(1/转速)/2

  - 传输时间=每次读写的字节数/(转速*每个磁道的字节数)

- 调度算法

  - 先来先服务算法FCFS

  - 最短寻道时间优先算法SSTF(最近)

  - 扫描算法/电梯调度算法SCAN(移动方向上最近)

  - 循环扫描算法C-SCAN(单项移动)

- 磁盘格式化、坏扇区概念

- ps.自举程序通常保存在ROM中

