# 概述

## 链路与数据链路

- 数据流动图
  - ![img](https://raw.githubusercontent.com/DaiDuncan/PicUploader/main/img3/20210530085937.jpeg)

- 链路（link）是从一个结点到相邻结点的**一段物理线路**，中间没有任何其他的交换结点

- 当需要在一条线路上传送数据时，除了物理线路外，还**必须有通信协议**来控制数据的传输。把==实现这些协议的硬件和软件==加到链路上，就构成了数据链路

- 也有人把链路分为物理链路和逻辑链路

  - 物理链路就是所说的链路

  - 逻辑链路就是所说的数据链路，是物理链路加上**必要的通信协议**

## 点到点链路与广播链路

- 点到点链路
  - 点到点链路（point-to-point link）使用一对一的点对点通信方式，由一条链路两端的发送结点和接收结点组成

- 广播链路

  - 广播链路（broadcast link）使用一对多的广播通信方式，它能够让多个发送结点和接收结点都连接到单一的、共享的广播信道上，因此必须**使用专用的共享信道协议**来协调这些主机的数据发送，因此过程比较复杂

  - 这里使用术语“广播”，是因为当任何一个结点传输一个数据帧时，都要经过该信道广播该数据帧，使连接的每个其余结点均能收到该数据帧的一个副本



## 数据链路层的简化模型

- 简化的三层结构模型
  - ![img](https://raw.githubusercontent.com/DaiDuncan/PicUploader/main/img3/20210530090306.jpeg)

- 只考虑数据链路层的简化模型
  - ![img](https://raw.githubusercontent.com/DaiDuncan/PicUploader/main/img3/20210530090323.jpeg)



# 需要解决的基本问题

- 数据帧**定界**

  - 在一段数据的前后**分别添加首部和尾部**，然后就构成了一个帧。要点：确定帧的界限

  - 数字管道模型
    - ![img](https://raw.githubusercontent.com/DaiDuncan/PicUploader/main/img3/20210530090339.jpeg)

  - 用控制字符进行帧定界
    - ![img](https://raw.githubusercontent.com/DaiDuncan/PicUploader/main/img3/20210530090350.jpeg)

- 透明传输

  - 透明传输是指不管发送端发送的数据帧是**怎么样的比特组合**，都应当能够在链路上传送，而接收端应该能够准确无误地识别出完整的数据帧

  - 字符填充

    - 发送端的数据链路层在数据中出现控制字符“SOH”或“EOT”的前面**插入一个转义字符“ESC”**(其十六进制编码是 1B)

    - 例子
      - ![img](https://raw.githubusercontent.com/DaiDuncan/PicUploader/main/img3/20210530090623.jpeg)

- 差错检测

  - 在传输过程中可能会产生比特差错：1 可能会变成 0 ，0 也可能变成 1

  - 循环冗余检验

    - 原理

      - CRC检验也称为多项式编码（Polynomial Code），它将发送的**二进制序列看作系数为0或1的一个多项式**，对二进制序列的操作也称为多项式算术。CRC校验码由两部分组成，前一部分是k+1个比特的待发送信息，后一部分是r个比特的冗余码。前k+1个比特部分是实际要传送的内容，是固定不变的。CRC校验码的关键在于**后一部分r个比特冗余码的计算**

      - CRC冗余码的计算中要用到两个多项式： F(x)和G(x) ，其中，F(x)是一个k阶多项式，其系数是待发送的k+1位二进制序列， G(x)是一个r阶的生成多项式，由收发双方预先约定

      - 图
        - ![img](https://raw.githubusercontent.com/DaiDuncan/PicUploader/main/img3/20210530090731.jpeg)



# 点到点链路的数据链路层协议PPP

- PPP协议简介

  - PPP协议的特点

    - 支持点到点的连接，不同于X.25、frame relay等数据链路层协议，具有CHAP、PAP验证协议，更好的保证了网络的安全性

    - PPP的物理层既支持数据为8位和无奇偶校验的异步模式，还支持面向比特位的同步链接，如frame relay必须为同步电路

    - PPP有针对不同网络层的网络控制协议，如IPCP，IPXCP。并且允许双方协商是否对报文首部进行压缩

    - 提供了一整套方案解决链路建立、维护、折除上层协议协商、认证等问题

- PPP协议组成

  - 一个将 IP 数据报封装到串行链路的方法

  - 链路控制协议 LCP (Link Control Protocol)，用来建立、配置和测试数据链路连接

  - 网络控制协议 NCP (Network Control Protocol)，其中的每一个协议支持不同的网络层协议

- PPP协议的帧格式

  - 帧格式图
    - ![img](https://raw.githubusercontent.com/DaiDuncan/PicUploader/main/img3/20210530090852.jpeg)

  - 包含的字段

    - 标志字段 F = 0x7E （符号“0x”表示后面的字符是用十六进制表示。十六进制的 7E 的二进制表示是 01111110）

    - 地址字段 A 只置为 0xFF。固定不变

    - 控制字段 C 通常置为 0x03。固定不变

    - 协议字段

      - 当协议字段为 0x0021 时，PPP 帧的信息字段就是IP 数据报。

      - 若为 0xC021, 则信息字段是 PPP 链路控制数据。

      - 若为 0x8021，则表示这是网络控制数据。

    - 信息字段。最大默认长度是1500字节

    - 检验和FCS

- PPP协议的透明传输实现

  - 异步传输

    - 使用一种特殊的字符填充法

    - 把转义符定义为0x7D，并使用字节填充

  - 同步传输
    - 协议规定采用硬件来完成比特填充

  - 字符填充

    - 将信息字段中出现的每一个 0x7E 字节转变成为 2 字节序列(0x7D, 0x5E)

    - 若信息字段中出现一个 0x7D 的字节, 则将其转变成为 2 字节序列(0x7D, 0x5D)

    - 若信息字段中出现 ASCII 码的控制字符（即数值小于 0x20 的字符），则在该字符前面要加入一个 0x7D 字节，同时将该字符的编码加以改变

    - 举例
      - ![img](https://raw.githubusercontent.com/DaiDuncan/PicUploader/main/img3/20210530090900.jpeg)

  - 零比特填充

    - 发送端
      - 只要发现有 5 个连续 1，则立即填入一个 0。

    - 接收端
      - 每当发现 5 个连续1时，就把这 5 个连续 1 后的一个 0 删除

    - 举例
      - ![img](https://raw.githubusercontent.com/DaiDuncan/PicUploader/main/img3/20210530090905.jpeg)

- PPP协议的链路状态

  - 当用户拨号接入 ISP 时，路由器的调制解调器对拨号做出确认，并建立一条物理连接

  - PC 机向路由器发送一系列的 LCP 分组（封装成多个 PPP 帧）。这些分组及其响应选择将要使用的一些 PPP 参数

  - 接着进行网络层配置，NCP 给新接入的 PC机分配一个临时的 IP 地址，使 PC 机成为因特网上的一个主机

  - 通信完毕时，NCP 释放网络层连接，收回原来分配出去的 IP 地址。接着，LCP 释放数据链路层连接。最后释放的是物理层的连接



