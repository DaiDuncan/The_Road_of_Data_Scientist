# 工具：R

[Link: 简书](https://www.jianshu.com/p/67be9b3806cd)

![image-20210221145320967](https://cdn.jsdelivr.net/gh/DaiDuncan/PicUploader/img/20210221145321.png)

| 总体-参数            | 样本-统计量                                                  |
| -------------------- | ------------------------------------------------------------ |
| 统计推断             | 研究如何**利用样本数据**来推断总体特征的统计学方法：<br />  参数估计  <br />  假设检验 |
| 组间差异检验         | 组间的差异分析以及显著性检验  <br />应用统计学上的假设检验方法，检验组间是否有差异及其差异程度 |
|                      | 所有的差异检验都基于一个假设：组间没有差异，变量之间没有关系 |
| 方差分析             | 不同水平下==**是否有差异化**==的假设检验问题                 |
| 假设检验             | 先对总体参数提出某种假设，然后利用样本信息判断假设是否成立的过程。 |
|                      | 1 参数检验：针对**参数**做的假设  <br />对未知参数的假设进行检验称为参数统计，所用的检验叫做参数检验     <br />例如两样本比较的t检验是判断**两样本分别代表的**总体的均值是否具有差异，属于参数检验。 |
|                      | 2 非参数检验：针对**总体分布情况**做的假设  <br />不依赖**总体分布的具体形式**，也**不对参数进行估计**或检验的统计方法，叫做非参数统计，其检验方法就是非参数检验     <br /><br />两样本比较的秩和检验（wilcoxcon 检验及Mann-Whitney 检验）是判断两样本分别代表的**总体的位置**有无差别（即两总体的变量值有无倾向性的未知偏离），自然属于非参数检验。 |
|                      | 二者的根本区别在于：<br />  参数检验要利用到总体的信息（总体**分布**、总体的**一些参数特征如方差**），以总体分布和样本信息对总体参数作出推断；     <br />  非参数检验不需要利用总体的信息（总体分布、总体的一些参数特征如方差），以样本信息对总体分布作出推断。 |
|                      | 参数检验只能用于等距数据和比例数据<br />非参数检验主要用于**记数数据**。也可用于等距和比例数据，但精确性就会降低。 |
|                      | 非参数检验一般**不直接用样本观察值**作分析，统计量的计算基于原始数据在整个样本中的秩次，丢弃了观察值的具体数值，因此凡适合参数检验的资料，应首选参数检验。  <br /><br />但是不清楚是否合适参数检验的资料，则应采用非参数检验。 |
| 抽样分布             | 关键信息：研究对象整体处于什么状态                           |
| 现代数理统计学的基础 | 三大抽样分布：<br />  1）t分布：关于均值的分布  <br />  2）卡方分布：关于方差的分布  <br />  3）**F**分布：关于方差的分布  <br />正态分布：关于均值的分布 |
|                      | 离开**分布**，假设检验无从谈起；  <br />离开**假设检验**，差异分析毫无根基 |
|                      |                                                              |
| @卡方分布            | ![image-20210221151506212](https://cdn.jsdelivr.net/gh/DaiDuncan/PicUploader/img/20210221151506.png) |
| @t分布               | ![image-20210221151520053](https://cdn.jsdelivr.net/gh/DaiDuncan/PicUploader/img/20210221151520.png) |
| @F分布               | ![image-20210221151532287](https://cdn.jsdelivr.net/gh/DaiDuncan/PicUploader/img/20210221151532.png) |

变量较多，判断组间差异时需要**多重检验的情况**，在宏基因组扩增子差异分析中十分常见。

基于单次比较的检验标准将变得过于宽松，使得阳性结果中的错误率（FDR 值FalseDiscovery Rate）非常大（已经大到令人不可忍受的地步）@多重检验校正



## R语言

| 分类                      |                                                              |
| ------------------------- | ------------------------------------------------------------ |
| 1 观察差异                | 统计的意义之一                                               |
|                           | ![image-20210221151708700](https://cdn.jsdelivr.net/gh/DaiDuncan/PicUploader/img/20210221151708.png) |
|                           | @散点图：一款百搭的工具，可以和箱线图结合着用，当然多元分析大多也得借助这个的散点图<br/><br/>比如，回归分析、排序（PCA。CA、CCA、RDA，NMDS，PCoA）、聚类（均值聚类 、划分）用散点图来反映都是比较直观地。<br />也开发有新的散点图比如叫火山图。 |
|                           | @树状图：一般有进化树和层次聚类树，如果你想表达对象之间的距离差异，最直观的的也许就是树状图 |
| 2 基于物种的差异检验      | 找出分组间丰度变化差异显著的物种，并得到差异物种在不同分组间的富集情况，同时，可以比较组内差异和组间差异的大小，判断不同分组间的群落结构差异是否具有显著意义。<br/>也就是说可以找出区别组间的一个biomarker。<br/> |
|                           | 这类检验一般只输出p值，它的目的很简单，就是检验比较组之间的相似性距离是否有差异。<br/>常用的分析方法有卡方检验、Student t检验、Wilcoxon秩和检验等等。 |
|                           | 1）如果只有两个样本比较，适合用卡方检验                      |
|                           | 2）如果是两组样本（至少3重复），可以试一下Student t，Welch‘st以及Wilcoxon秩和检验<br /><br /><br />Student t检验需要样本符合正态分布，而且方差对齐。<br/>当组间样本数不同，方差也不对齐的时候，Welch’s t检验是很好的选择。<br /><br /><br />Wilcoxon秩和检验又叫Mann-Whitney U 检验，是基于变量排名的一种统计方法，不需要样本符合正态分布，也不需要样本方差对齐，是更为广泛的检验方法，但同时也由于检验太宽松，容易带来很多**假阳性**。 |
|                           | 3）如果是多组样本比较，可以选择one way ANOVA、TURKEY以及Kruskal-Wallis H检验等方法<br /><br />one way ANOVA和TURKEY其实都是基于方差分析，只不过后者带有后验，可以知道两个分组对整体差异的贡献度。<br /><br />Kruskal-Wallis H检验本质也是一种秩和检验，与前两者的区别在于，它不需要样本数和方差的对齐，应用更为广泛。Kruskal-Wallis检验又被称之为单因素非参数方差分析。 |
| @差异检测中的两种集成方法 | 毫不客气地讲，一般秩和检验或置换检验属于非参数检验。在这类差异检验中，有两种集成方法特别值得我们注意：LEfSe 、metastats。 |
|                           | 1）LEfSe （LDA EffectSize）                                  |
|                           | 2）metastats                                                 |
|                           |                                                              |
| 3 基于矩阵的检验方法      | 所谓基于距离也就是检验的是群落差异而不是某个物种。<br />上面所提及的检验方法，其实都只能告诉大家，这些分组是否有显著差异（可以简单理解为有无）。<br />那如果想同时知道这些差异的程度呢？ |
|                           | 需要Anosim，Adonis以及MRPP等检验方法。<br />这些方法不但可以输出检验显著性结果（p值），还有程度结果（R值），R值可以用来判断分组贡献度大小。<br />Anosim、Adonis这些可用于多元统计检验的模型就非常适合了。<br />要值得注意的是，Anosim本质是基于排名的算法，其实与NMDS的配合效果最好。<br />如果是PCoA分析，建议配合使用Adonis检验结果。 |
|                           | ![image-20210221152022915](https://cdn.jsdelivr.net/gh/DaiDuncan/PicUploader/img/20210221152023.png) |
|                           | 1）Anosim（Analysis of similarities）<br/>                   |
|                           | 2）ADONIS又称置换多因素方差分析（permutational MANOVA）或非参数多因素方差分析（nonparametric MANOVA）<br/> |
|                           | 3）MRPP<br/>                                                 |
|                           | 4）amova<br/>                                                |
|                           | 5）Mantel test                                               |



无论你从事何种领域的科学研究还是统计调查，**显著性检验**作为判断==两个乃至多个数据集之间是否存在差异的方法==被广泛应用于各个科研领域。

![image-20210221152113283](https://cdn.jsdelivr.net/gh/DaiDuncan/PicUploader/img/20210221152113.png)





# 工具：Excel

| 分析工具                       | 数据分析 |
| ------------------------------ | -------- |
| 方差分析：单因素               |          |
| 方差分析：可重复双因素         |          |
| 方差分析：无重复双因素         |          |
| 相关系数                       |          |
| 协方差                         |          |
| 描述统计                       |          |
| 指数 平滑                      |          |
| F检验：双样本方差              |          |
| 傅里叶分析                     |          |
| 直方图                         |          |
| 移动 平均                      |          |
| 随机数发生器                   |          |
| 排位与百分比排位               |          |
| 回归                           |          |
| 抽样                           |          |
| t检验：平均值的成对 二样本分析 |          |
| t检验：双样本等方差假设        |          |
| t检验：双样本异方差假设        |          |
| z检验：双样本平均差检验        |          |
| F检验-双样本方差检验           |          |

注意：单因素是指分类中，该类别只有1个因素

- 比如双因素：观测样本中高压锅的品牌类别有两个



注意|未提供：

- 单样本均值，比例，方差的检验

- 未提供双样本**总体比例**的检验！





# 工具|SPSS

![image-20210221153739266](https://cdn.jsdelivr.net/gh/DaiDuncan/PicUploader/img/20210221153739.png)

## 参数检验

| 检验类型        |                                                              |
| --------------- | ------------------------------------------------------------ |
| @正态检验       | 前提要先做正态性检验，但这一个问题可以有很多方法来处理<br />一个是画直方图，pp，qq，只是定性分析<br />还有其他的方法，像R里的shapiro.test，ks检验用的比较多 |
|                 | ![image-20210221153915835](https://cdn.jsdelivr.net/gh/DaiDuncan/PicUploader/img/20210221153915.png) |
| @方差不齐的检验 | 如果通过Levene F方法检验**方差不齐，**则需要用校正的t检验，或者用非参数方法处理。 |
|                 |                                                              |
| t检验           | 通过两个样本之差的分布去推断，两个样本数据应满足正态分布条件，方差齐，还要相互独立<br />之所以叫t检验，是因为构建的统计量是t统计量，t统计量服从n1+n2-2个自由度的t分布 |
| 卡方分布        | 独立性检验，两个分类变量之间是否存在联系<br/>比如产品的质量与产地是否有关 |
|                 | 卡方检验可以用于正态性检验<br />独立性检验（比如说牛奶的质量是否与产地有关), 比较分类变量比例之间是否有显著差异（比如两个城市之间不同社会阶层的收入水平占比是否有差异） |
| F检验(方差分析) | t检验是用来比较样本均值的，f检验是用来比叫方差的，又分单因素，双因素，多因素，就是对一种目标，有一个变量或多个变量影响这该目标，比如亩产，有品种，肥力，灌溉等因素，哪个因素是主要影响因素呢？<br/><br/>使用方差分析需要满足（正态，方差齐） |



## 非参数检验

[Link: CSDN|数据**不符合**正态分布时](https://blog.csdn.net/m0_37228052/article/details/89639426)

如果将数据取对数，或者开根号等处理后仍然不满足正态分布的前提条件，可以采用非参数的方法分析



非参数检验：主要**不是用变量的值**，而是用秩作为分析对象。

| 检验类型                                |                                                              |
| --------------------------------------- | ------------------------------------------------------------ |
| @IBM SPSS                               | ![image-20210221154135926](https://cdn.jsdelivr.net/gh/DaiDuncan/PicUploader/img/20210221154136.png) |
| @混合模型，生存函数，多重响应，多重归因 | ![image-20210221154148606](https://cdn.jsdelivr.net/gh/DaiDuncan/PicUploader/img/20210221154148.png) |
|                                         |                                                              |
|                                         |                                                              |
| #U检验                                  | 要满足四个假设                                               |
| 假设1                                   | 数据中有一个因变量，且因变量为连续变量或等级变量<br/>        |
|                                         | 例如：<br/>连续变量——智力得分、考试分数、体重；<br/>等级变量——满意程度（包括非常不满意、不满意、满意、非常满意） |
| 假设2                                   | 数据中有一个自变量，且自变量为二分类的独立变量               |
|                                         | 例如：<br/>性别分组——男性组、女性组；<br/>生活习惯——吸烟组、非吸烟组。 |
| 假设3                                   | 观察值之间相互独立，即自变量的两个分组中的研究个体不能相关   |
|                                         | 研究数据不符合此项条件，<br/>例如测量同一组患者治疗前与治疗后的血生化指标，这样数据属于配对样本数据，应选用Wilcoxon符号秩和检验。 |
|                                         | 例如：<br/>对比两个班级的学生的考试分数；<br/>对比患者与健康者的血生化指标。 |
| 假设4                                   | 自变量中两组样本的分布一致                                   |
|                                         |                                                              |
| #KS检验                                 | 不仅可以检验单个总体是否服从某一理论分布，<br/>还能检验两个总体分布是否存在显著差异 |
| #Moses极端反应检验                      |                                                              |
| #W检验                                  |                                                              |





# 补充|ANOVA

## 理论

两个/多个样本的参数估计和假设检验

| 样本                                        |                                                              |
| ------------------------------------------- | ------------------------------------------------------------ |
| 两样本                                      | 例如：某种新型眼药水的检验问题，厂家声称它比传统的眼药水见效快，检验这个说法可以用独立样本或成对样本。 |
| @独立样本                                   | 随机选取两组不同的测试者，其中一组用传统眼药水，另一组用新型眼药水 |
| @成对样本                                   | 能够较好的控制外部变量  只选一组测试者，并让每个人左眼使用传统麻醉剂，右眼使用新型麻醉剂     此外成对样本在两样本估计和假设检验问题上的置信区间更精确，检验功效更强 |
|                                             |                                                              |
| 多个样本                                    | 同时处理三个或更多的总体，各总体分别具有均值和标准差，根据来自这些总体的样本进行总体参数的估计与假设检验 |
| 方差分析                                    | 利用样本信息来检验关于k个总体的均值的假设的方法，还能用于确定总体均值的置信区间和估计各个总体方差的差距。 |
| 多样本的统计假设                            | ![image-20210221154759491](https://cdn.jsdelivr.net/gh/DaiDuncan/PicUploader/img/20210221154759.png) |
|                                             | ![image-20210221154806719](https://cdn.jsdelivr.net/gh/DaiDuncan/PicUploader/img/20210221154806.png) |
| @因子(因素)、水平                           | 例如：有一个**因子（水稻的品种）**可能会影响到因变量（植株的高度）。<br />因子的不同类别称为“水平”，例如：品种1、品种2和品种3。 |
| #单向方差分析                               | @==假设前提==<br/>1、所有总体（例如：k个水稻的品种）都服从正态分布，都有各自的均值与方差；<br/>2、所有总体方差都相同；<br/>3、所有样本互相独立，取自各自总体，样本容量可以相同也可以不同。 |
|                                             | @例子<br/>以水稻例子来阐述：有三个品种的水稻，针对这它们进行试验：将每个品种各取5株在培养室中培育，然后在其成熟期（发芽后的130天）测量各株的高度（单位：厘米），数据列在下表中：<br />![image-20210221154858856](https://cdn.jsdelivr.net/gh/DaiDuncan/PicUploader/img/20210221154858.png) |
| 1）组内平方和SSW（Sum of square of within） | 各个品种内部围绕**各自平均值**的变差的一种度量，计算如下：<br />![image-20210221154910405](https://cdn.jsdelivr.net/gh/DaiDuncan/PicUploader/img/20210221154910.png) |
| 2）组间平方和SSA（Sum of square of among）  | 样本间随机变差以及因处理不同而可能导致的样本均值变差的一种度量：<br />![image-20210221154924320](https://cdn.jsdelivr.net/gh/DaiDuncan/PicUploader/img/20210221154924.png) |
|                                             | ——>组间方差更大？                                            |
| 3）总平方和SST（Sum of square of total）    | 所有数据变差的总和：<br />![image-20210221154938942](https://cdn.jsdelivr.net/gh/DaiDuncan/PicUploader/img/20210221154939.png) |
| SST=SSA+SSW                                 | 对于单向方差分析，总变差可以分解成两部分：<br />   一组样本内部由于随机选取或处理方法不同产生的变差SSW；<br />   不同组样本之间由于因素（因子）的原因产生的变差SSA。<br />所以总变差SST等于SSW与SSA之和。<br/>	SSA=19.6；SSW=14.8；<br/>	SSA+SSW=19.6+14.8=34.4=SST |
| 4）均方                                     | 为了得到总体方差的无偏估计，必须将样本平方和除以一个恰当的自由度，在方差分析中，将这种样本平方和除以自由度得到的方差称为均方 |
|                                             | 上面已经计算得到了三个平方和，除以相对应的自由度，得到三个均方MSA,MSW,MST： |
|                                             | 1）MSW的计算：用组内平方和除以自由度<br />因为组内平方和先计算得到每一组样本的平方和，然后再相加得到，所以自由度为k(n-1)=3*(5-1)=12<br />![image-20210221155025839](https://cdn.jsdelivr.net/gh/DaiDuncan/PicUploader/img/20210221155025.png) |
|                                             | @me-对自由度的理解<br/>5个样本，均值已知：知道4个数值，可推导出另一个数值——>自由度为5-1=4 |
|                                             | 2）MSA的计算：用组间平方和除以自由度<br />因为组间平方和先计算每组样本的均值，然后与总均值计算平方和，所以自由度为k-1=3-1=2<br />![image-20210221155045095](https://cdn.jsdelivr.net/gh/DaiDuncan/PicUploader/img/20210221155045.png) |
|                                             | @自由度：知道k-1组——>推出最后一组                            |
|                                             | 3）MST的计算：用总平方和除以自由度<br />因为总平方和是所有的样本值与总均值差得平方和，所以自由度为nk-1=5*3-1=14<br />![image-20210221155104108](https://cdn.jsdelivr.net/gh/DaiDuncan/PicUploader/img/20210221155104.png) |
|                                             | @自由度 所有样本点数量-1                                     |
|                                             |                                                              |
| F检验@F统计量                               | ![image-20210221155121646](https://cdn.jsdelivr.net/gh/DaiDuncan/PicUploader/img/20210221155121.png) |
|                                             | 在单向方差分析中，为了适用F检验，构造了两个方差：组间方差和组内方差；<br />将组内方差（样本内方差）作为分母，组间方差（样本间方差）作为分子。<br />前面假设了所有总体（品种）方差相等，即有共同方差，所以组内方差和组间方差是共同方差的两个点估计<br/> |
|                                             | 基于这个假设，F统计量可以表示为：<br />![image-20210221155146607](https://cdn.jsdelivr.net/gh/DaiDuncan/PicUploader/img/20210221155146.png) |
|                                             |                                                              |
| 单向方差分析基本原理                        | 一个正态分布可以由两个参数（均值和方差）完全确定，单向方差分析假设所有总体方差相同，所以要检验所有总体均值是否相等，也就是要检验所有样本是否来自一个总体。 |
|                                             | 之所以可以用F检验来检验所有总体均值是否相等，是因为单向方差分析假设所有总体方差相同，所以F统计量可以简化为：<br />![image-20210221155205199](https://cdn.jsdelivr.net/gh/DaiDuncan/PicUploader/img/20210221155205.png) |
|                                             | MSA和MSW都是通过样本数值计算得到的，计算过程包含样本均值，样本均值是总体均值的无偏估计。<br />若零假设为真，样本均值是总体均值的无偏估计，则抽样数据得到的F的值应该接近于1；如果零假设不真，则F值会显著的大于1。<br/><br/>这样就可以通过F检验的方式来检验各总体均值是否相等（样本是否来自同一个总体） |
| @例子                                       | 用上方例题：有三个品种的水稻，针对这它们进行试验：将每个品种各取5株在培养室中培育，然后在其成熟期（发芽后的130天）测量各株的高度（单位：厘米），在0.05的显著水平下作右尾检验，数据列在下表中：<br />![image-20210221155239031](https://cdn.jsdelivr.net/gh/DaiDuncan/PicUploader/img/20210221155239.png) |
|                                             | ![image-20210221155244109](https://cdn.jsdelivr.net/gh/DaiDuncan/PicUploader/img/20210221155244.png) |
| @工具：统计软件(方差分析表)                 | ![image-20210221155249680](https://cdn.jsdelivr.net/gh/DaiDuncan/PicUploader/img/20210221155250.png) |
|                                             | @方差分析表如下：<br />![image-20210221155258496](https://cdn.jsdelivr.net/gh/DaiDuncan/PicUploader/img/20210221155258.png) |







## 应用

### 1 两总体均值差的95%置信区间

​	通过两样本估计总体

![image-20210221154702185](https://cdn.jsdelivr.net/gh/DaiDuncan/PicUploader/img/20210221154702.png)



### 2 两总体均值差的假设检验

范例2：独立随机样本取自均值未知，标准差已知的两个正态分布总体，第一个总体，标准差为0.73，样本容量为25，样本均值为7.3；第二个总体，标准差为0.89，样本容量为20，样本均值为6.7；在显著水平为0.01下作两总体均值差等于0的右尾检验。

![image-20210221154730366](https://cdn.jsdelivr.net/gh/DaiDuncan/PicUploader/img/20210221154730.png)





| 目标      | 比较均值的差异  <br />    两两之间的均值差异：t检验 |
| --------- | --------------------------------------------------- |
| @多于两组 | @计算过程  F——>方差  p——>统计显著水平               |



1 ANOVA的前提假设

- 独立的样本
- 数据总体服从正态分布
- 组与组之间的方差相等：方差齐性





2 实例|收入水平

![image-20210221155407137](https://cdn.jsdelivr.net/gh/DaiDuncan/PicUploader/img/20210221155407.png)

1）单因子：均值(数据探索)

<img src="https://cdn.jsdelivr.net/gh/DaiDuncan/PicUploader/img/20210221155414.png" alt="image-20210221155414688" style="zoom:80%;" />



| 假设检验 |                                               |
| -------- | --------------------------------------------- |
| $H_0$    | $\mu_{None}=\mu_{School}=\mu_{Voc}=\mu_{Deg}$ |
| $H_1$    | 并非所有均值都一致相同                        |



2）针对整体的假设检验：p太小，否定H0

| 工具    |                                                              |
| ------- | ------------------------------------------------------------ |
| ANOVA： | ![image-20210221155617438](https://cdn.jsdelivr.net/gh/DaiDuncan/PicUploader/img/20210221155617.png) |
| Jasp    | ![image-20210221155601319](https://cdn.jsdelivr.net/gh/DaiDuncan/PicUploader/img/20210221155601.png) |



3）在否定H0的条件下：两两组合进行检验

![image-20210221155627146](https://cdn.jsdelivr.net/gh/DaiDuncan/PicUploader/img/20210221155627.png)

结论：只有school和vocation的数据均值没有显著性差异(对比上述箱线图)







如果不符合ANOVA的前提假设——>非参数检验：Kruskal-Wallis

![image-20210221155644726](https://cdn.jsdelivr.net/gh/DaiDuncan/PicUploader/img/20210221155644.png)

1）描述信息

说明方差相差大——不符合方差齐性

样本数量也不同

2）对比ANOVA 和 Kruskal-Wallis

<img src="https://cdn.jsdelivr.net/gh/DaiDuncan/PicUploader/img/20210221155653.png" alt="image-20210221155653618" style="zoom:80%;" />